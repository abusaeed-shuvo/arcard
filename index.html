<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
		/>
		<title>AR Business Card</title>
		<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			html,
			body {
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
				overflow: hidden;
				font-family: Arial, sans-serif;
				position: fixed;
			}

			a-scene {
				width: 100% !important;
				height: 100% !important;
			}

			.a-canvas {
				width: 100% !important;
				height: 100% !important;
			}

			.debug-panel {
				position: absolute;
				top: 10px;
				left: 10px;
				background: rgba(0, 0, 0, 0.85);
				color: #fff;
				padding: 15px;
				border-radius: 8px;
				z-index: 9999;
				font-size: 12px;
				max-width: 300px;
			}

			.debug-panel h3 {
				margin: 0 0 10px 0;
				font-size: 14px;
			}

			.status-item {
				margin: 5px 0;
				padding: 5px;
				background: rgba(255, 255, 255, 0.1);
				border-radius: 4px;
			}

			.success {
				color: #4caf50;
			}
			.warning {
				color: #ffc107;
			}
			.error {
				color: #f44336;
			}

			#loadingOverlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: #000;
				color: white;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				z-index: 10000;
				text-align: center;
				padding: 20px;
				box-sizing: border-box;
			}

			.spinner {
				border: 4px solid rgba(255, 255, 255, 0.3);
				border-top: 4px solid white;
				border-radius: 50%;
				width: 40px;
				height: 40px;
				animation: spin 1s linear infinite;
				margin: 20px;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			#instructions {
				position: absolute;
				bottom: 20px;
				left: 50%;
				transform: translateX(-50%);
				background: rgba(0, 0, 0, 0.8);
				color: white;
				padding: 15px 25px;
				border-radius: 25px;
				z-index: 9998;
				text-align: center;
			}

			.button {
				background: #2196f3;
				color: white;
				border: none;
				padding: 10px 20px;
				margin: 10px 5px;
				border-radius: 5px;
				cursor: pointer;
				font-size: 14px;
			}
		</style>
	</head>
	<body>
		<!-- Loading Overlay -->
		<div id="loadingOverlay">
			<h2>ðŸš€ AR Business Card</h2>
			<div class="spinner"></div>
			<p id="loadingText">Initializing AR...</p>
			<div style="margin-top: 20px; font-size: 12px; color: #999">
				<p>ðŸ“· Camera permission required</p>
				<p>
					ðŸŽ¯ Need a marker?
					<a
						href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png"
						target="_blank"
						style="color: #2196f3"
						>Download Hiro</a
					>
				</p>
			</div>
		</div>

		<!-- Debug Panel -->
		<div class="debug-panel">
			<h3>Debug Info</h3>
			<div class="status-item">
				Camera: <span id="cameraStatus" class="warning">Checking...</span>
			</div>
			<div class="status-item">
				AR.js: <span id="arjsStatus" class="warning">Loading...</span>
			</div>
			<div class="status-item">
				Marker: <span id="markerStatus" class="warning">Waiting...</span>
			</div>
			<div
				style="
					margin-top: 10px;
					padding-top: 10px;
					border-top: 1px solid rgba(255, 255, 255, 0.2);
				"
			>
				<button class="button" onclick="location.reload()">Reload</button>
				<button class="button" onclick="toggleDebug()">Hide Debug</button>
			</div>
		</div>

		<div id="instructions">ðŸ“± Point at Hiro marker</div>

		<!-- AR Scene -->
		<a-scene
			embedded
			arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono; trackingMethod: best; sourceWidth: 1280; sourceHeight: 960; displayWidth: 1280; displayHeight: 960;"
			vr-mode-ui="enabled: false"
			renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true; alpha: true;"
			device-orientation-permission-ui="enabled: false"
			style="position: absolute; top: 0; left: 0; width: 100%; height: 100%"
		>
			<a-assets>
				<a-asset-item
					id="marker-asset"
					src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro"
				></a-asset-item>
			</a-assets>

			<a-marker
				preset="hiro"
				id="markerElement"
				smoothCount="10"
				smoothTolerance="0.01"
				smoothThreshold="5"
			>
				<!-- Card Base with shadow -->
				<a-entity id="card-group">
					<!-- White card base -->
					<a-box
						position="0 0.05 0"
						width="2"
						height="0.08"
						depth="1.3"
						color="#ffffff"
						material="shader: flat"
					>
					</a-box>

					<!-- Blue accent strip -->
					<a-box
						position="0 0.09 -0.6"
						width="2"
						height="0.01"
						depth="0.1"
						color="#2196F3"
					>
					</a-box>

					<!-- Animated Logo Cube -->
					<a-box
						position="0 0.35 0"
						rotation="0 45 0"
						scale="0.3 0.3 0.3"
						color="#2196F3"
						material="shader: flat"
						animation="property: rotation; to: 0 405 0; loop: true; dur: 4000; easing: linear"
						animation__hover="property: position; to: 0 0.45 0; dir: alternate; loop: true; dur: 1500; easing: easeInOutSine"
					>
					</a-box>

					<!-- Name -->
					<a-text
						value="JOHN DOE"
						align="center"
						color="#000000"
						width="3.5"
						position="0 0.1 0.55"
						shader="msdf"
						font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/roboto/Roboto-Bold.json"
					>
					</a-text>

					<!-- Title -->
					<a-text
						value="Creative Developer"
						align="center"
						color="#555555"
						width="2.8"
						position="0 0.1 0.4"
						shader="msdf"
						font="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/roboto/Roboto-Regular.json"
					>
					</a-text>

					<!-- Interactive Email Button -->
					<a-plane
						position="-0.5 0.1 0.1"
						width="0.7"
						height="0.18"
						color="#4CAF50"
						id="emailButton"
						class="clickable"
					>
						<a-text
							value="EMAIL"
							align="center"
							color="#ffffff"
							width="2.5"
							position="0 0 0.01"
						>
						</a-text>
					</a-plane>

					<!-- Interactive Website Button -->
					<a-plane
						position="0.5 0.1 0.1"
						width="0.7"
						height="0.18"
						color="#2196F3"
						id="websiteButton"
						class="clickable"
					>
						<a-text
							value="WEBSITE"
							align="center"
							color="#ffffff"
							width="2.3"
							position="0 0 0.01"
						>
						</a-text>
					</a-plane>

					<!-- Contact Details -->
					<a-text
						value="+1 234 567 890"
						align="center"
						color="#333333"
						width="2.5"
						position="0 0.1 -0.1"
					>
					</a-text>

					<a-text
						value="john.doe@example.com"
						align="center"
						color="#333333"
						width="2"
						position="0 0.1 -0.28"
					>
					</a-text>

					<!-- Decorative elements -->
					<a-sphere
						position="0.85 0.5 0"
						radius="0.05"
						color="#FF5722"
						animation="property: position; to: 0.85 0.7 0; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine"
					>
					</a-sphere>
					<a-sphere
						position="-0.85 0.5 0"
						radius="0.05"
						color="#FFC107"
						animation="property: position; to: -0.85 0.7 0; dir: alternate; loop: true; dur: 2300; easing: easeInOutSine"
					>
					</a-sphere>
				</a-entity>
			</a-marker>

			<a-entity camera></a-entity>
		</a-scene>

		<script>
			// Debug status elements
			const cameraStatus = document.getElementById("cameraStatus");
			const arjsStatus = document.getElementById("arjsStatus");
			const markerStatus = document.getElementById("markerStatus");
			const loadingOverlay = document.getElementById("loadingOverlay");
			const loadingText = document.getElementById("loadingText");

			let cameraReady = false;
			let sceneReady = false;

			// Toggle debug panel
			window.toggleDebug = function () {
				const panel = document.querySelector(".debug-panel");
				panel.style.display = panel.style.display === "none" ? "block" : "none";
			};

			// Update camera status
			function updateCameraStatus(status, className) {
				cameraStatus.textContent = status;
				cameraStatus.className = className;
			}

			// Check camera permissions
			navigator.mediaDevices
				.getUserMedia({ video: { facingMode: "environment" } })
				.then((stream) => {
					updateCameraStatus("Active âœ“", "success");
					cameraReady = true;
					stream.getTracks().forEach((track) => track.stop());
					checkReady();
				})
				.catch((err) => {
					updateCameraStatus("Failed âœ—", "error");
					loadingText.textContent =
						"âŒ Camera access denied. Please allow camera and reload.";
					console.error("Camera error:", err);
				});

			// Scene loaded
			const scene = document.querySelector("a-scene");
			scene.addEventListener("loaded", () => {
				console.log("A-Frame scene loaded");
				arjsStatus.textContent = "Loaded âœ“";
				arjsStatus.className = "success";
				sceneReady = true;
				checkReady();
			});

			// Check if everything is ready
			function checkReady() {
				if (cameraReady && sceneReady) {
					setTimeout(() => {
						loadingOverlay.style.display = "none";
						// Force canvas resize
						window.dispatchEvent(new Event("resize"));
						resizeCanvas();
					}, 1000);
				}
			}

			// Fix canvas sizing
			function resizeCanvas() {
				const canvas = document.querySelector(".a-canvas");
				if (canvas) {
					canvas.style.width = "100%";
					canvas.style.height = "100%";
					canvas.width = window.innerWidth;
					canvas.height = window.innerHeight;
				}
			}

			// Handle window resize
			window.addEventListener("resize", resizeCanvas);
			window.addEventListener("orientationchange", () => {
				setTimeout(resizeCanvas, 100);
			});

			// Rendering started
			scene.addEventListener("renderstart", () => {
				console.log("AR rendering started");
				loadingText.textContent = "Camera active! Point at Hiro marker...";
				// Fix canvas on render start
				setTimeout(resizeCanvas, 500);
			});

			// Marker detection
			const marker = document.getElementById("markerElement");

			marker.addEventListener("markerFound", () => {
				console.log("âœ… Marker detected!");
				markerStatus.textContent = "Detected! âœ“";
				markerStatus.className = "success";
			});

			marker.addEventListener("markerLost", () => {
				console.log("âš ï¸ Marker lost");
				markerStatus.textContent = "Lost...";
				markerStatus.className = "warning";
			});

			// Button interactions (wait for scene to fully load)
			setTimeout(() => {
				const emailBtn = document.getElementById("emailButton");
				const websiteBtn = document.getElementById("websiteButton");

				if (emailBtn) {
					emailBtn.addEventListener("click", () => {
						console.log("Email clicked");
						window.location.href =
							"mailto:john.doe@example.com?subject=Hello%20from%20AR%20Card";
					});
				}

				if (websiteBtn) {
					websiteBtn.addEventListener("click", () => {
						console.log("Website clicked");
						window.open("https://example.com", "_blank");
					});
				}
			}, 2000);

			// Error logging
			window.addEventListener("error", (e) => {
				console.error("Error:", e.error);
				arjsStatus.textContent = "Error âœ—";
				arjsStatus.className = "error";
			});

			// Log device info
			console.log("User Agent:", navigator.userAgent);
			console.log("Protocol:", window.location.protocol);
			console.log("Screen:", window.innerWidth + "x" + window.innerHeight);
		</script>
	</body>
</html>
