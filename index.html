<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>AR Business Card</title>
		<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
		<style>
			body {
				margin: 0;
				overflow: hidden;
				font-family: Arial, sans-serif;
			}

			#overlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.9);
				color: white;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				z-index: 9999;
				padding: 20px;
				box-sizing: border-box;
				text-align: center;
			}

			#overlay.hidden {
				display: none;
			}

			#startBtn {
				background: #4caf50;
				color: white;
				border: none;
				padding: 15px 30px;
				font-size: 18px;
				border-radius: 25px;
				cursor: pointer;
				margin-top: 20px;
			}

			#startBtn:hover {
				background: #45a049;
			}

			#info {
				position: absolute;
				top: 10px;
				left: 10px;
				background: rgba(0, 0, 0, 0.7);
				color: white;
				padding: 15px;
				border-radius: 8px;
				z-index: 1000;
				max-width: 300px;
				font-size: 14px;
			}

			#status {
				color: #ffc107;
			}

			.found {
				color: #4caf50 !important;
			}

			#instructions {
				position: absolute;
				bottom: 20px;
				left: 50%;
				transform: translateX(-50%);
				background: rgba(0, 0, 0, 0.8);
				color: white;
				padding: 15px 25px;
				border-radius: 25px;
				z-index: 1000;
				text-align: center;
				font-size: 14px;
			}

			a {
				color: #2196f3;
				text-decoration: none;
			}
		</style>
	</head>
	<body>
		<!-- Start Overlay -->
		<div id="overlay">
			<h1>ðŸ“± AR Business Card</h1>
			<p>To use this AR experience:</p>
			<ol style="text-align: left; max-width: 400px">
				<li>
					Download the Hiro marker:
					<a
						href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png"
						target="_blank"
						>Click here</a
					>
				</li>
				<li>Open this page on your mobile phone</li>
				<li>Use HTTPS (required for camera access)</li>
				<li>Allow camera permissions</li>
				<li>Point camera at the Hiro marker</li>
			</ol>
			<button id="startBtn">Start AR Experience</button>
			<p style="font-size: 12px; margin-top: 20px; color: #999">
				Note: This must be hosted on HTTPS to work<br />
				Try: Netlify, GitHub Pages, or Vercel
			</p>
		</div>

		<!-- Info Panel -->
		<div id="info" style="display: none">
			<h3 style="margin: 0 0 10px 0">AR Business Card</h3>
			<p style="margin: 5px 0">
				Status: <span id="status">Starting camera...</span>
			</p>
			<small>Point at Hiro marker</small>
		</div>

		<div id="instructions" style="display: none">
			ðŸ“· Point camera at Hiro marker
		</div>

		<a-scene
			id="arScene"
			embedded
			arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
			vr-mode-ui="enabled: false"
			renderer="logarithmicDepthBuffer: true; precision: medium;"
			style="display: none"
		>
			<a-entity camera></a-entity>

			<a-marker
				preset="hiro"
				id="marker"
				smoothCount="5"
				smoothTolerance="0.01"
				smoothThreshold="2"
			>
				<!-- Card Base -->
				<a-box
					position="0 0 0"
					width="2.5"
					height="0.1"
					depth="1.5"
					color="#ffffff"
					shadow
				>
				</a-box>

				<!-- Logo Cube -->
				<a-box
					position="0 0.4 0"
					rotation="0 45 0"
					width="0.4"
					height="0.4"
					depth="0.4"
					color="#2196F3"
					animation="property: rotation; to: 0 405 0; loop: true; dur: 4000; easing: linear"
				>
				</a-box>

				<!-- Name -->
				<a-text
					value="JOHN DOE"
					align="center"
					color="#000000"
					width="4"
					position="0 0.08 0.65"
				>
				</a-text>

				<!-- Title -->
				<a-text
					value="Creative Developer"
					align="center"
					color="#666666"
					width="3"
					position="0 0.08 0.48"
				>
				</a-text>

				<!-- Email Button -->
				<a-box
					position="-0.6 0.08 0.15"
					width="0.8"
					height="0.2"
					depth="0.05"
					color="#4CAF50"
					id="emailBtn"
					class="clickable"
				>
					<a-text
						value="EMAIL"
						align="center"
						color="#ffffff"
						width="2.5"
						position="0 0 0.03"
					>
					</a-text>
				</a-box>

				<!-- Website Button -->
				<a-box
					position="0.6 0.08 0.15"
					width="0.8"
					height="0.2"
					depth="0.05"
					color="#2196F3"
					id="websiteBtn"
					class="clickable"
				>
					<a-text
						value="WEBSITE"
						align="center"
						color="#ffffff"
						width="2.2"
						position="0 0 0.03"
					>
					</a-text>
				</a-box>

				<!-- Contact Info -->
				<a-text
					value="ðŸ“± +1 234 567 890"
					align="center"
					color="#333333"
					width="2.5"
					position="0 0.08 -0.15"
				>
				</a-text>

				<a-text
					value="ðŸ“§ john.doe@example.com"
					align="center"
					color="#333333"
					width="2"
					position="0 0.08 -0.35"
				>
				</a-text>

				<!-- Floating Orbs -->
				<a-sphere
					position="1 0.6 0"
					radius="0.06"
					color="#FF5722"
					animation="property: position; to: 1 0.9 0; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine"
				>
				</a-sphere>
				<a-sphere
					position="-1 0.6 0"
					radius="0.06"
					color="#FFC107"
					animation="property: position; to: -1 0.9 0; dir: alternate; loop: true; dur: 2500; easing: easeInOutSine"
				>
				</a-sphere>
			</a-marker>
		</a-scene>

		<script>
			const overlay = document.getElementById("overlay");
			const startBtn = document.getElementById("startBtn");
			const arScene = document.getElementById("arScene");
			const info = document.getElementById("info");
			const instructions = document.getElementById("instructions");
			const statusEl = document.getElementById("status");

			// Start button click
			startBtn.addEventListener("click", async () => {
				try {
					// Check if we're on HTTPS or localhost
					const isSecure =
						window.location.protocol === "https:" ||
						window.location.hostname === "localhost" ||
						window.location.hostname === "127.0.0.1";

					if (!isSecure) {
						alert(
							"âš ï¸ Camera requires HTTPS!\n\nPlease host this file on:\n- GitHub Pages\n- Netlify\n- Vercel\n- Any HTTPS server"
						);
						return;
					}

					// Request camera permission explicitly
					const stream = await navigator.mediaDevices.getUserMedia({
						video: { facingMode: "environment" },
					});

					// Stop the test stream
					stream.getTracks().forEach((track) => track.stop());

					// Hide overlay and show AR
					overlay.classList.add("hidden");
					arScene.style.display = "block";
					info.style.display = "block";
					instructions.style.display = "block";

					statusEl.textContent = "Camera active - looking for marker...";
				} catch (error) {
					console.error("Camera error:", error);
					alert(
						"âŒ Camera access denied!\n\nPlease:\n1. Allow camera permissions\n2. Make sure you're on HTTPS\n3. Try refreshing the page"
					);
				}
			});

			// Wait for scene to load
			document.querySelector("a-scene").addEventListener("loaded", () => {
				const marker = document.getElementById("marker");
				const emailBtn = document.getElementById("emailBtn");
				const websiteBtn = document.getElementById("websiteBtn");

				// Marker detection
				marker.addEventListener("markerFound", () => {
					statusEl.textContent = "Marker found! ðŸŽ¯";
					statusEl.className = "found";
					console.log("Marker detected!");
				});

				marker.addEventListener("markerLost", () => {
					statusEl.textContent = "Looking for marker...";
					statusEl.className = "";
					console.log("Marker lost");
				});

				// Button interactions
				emailBtn.addEventListener("click", () => {
					console.log("Email button clicked");
					if (confirm("Open email client?")) {
						window.location.href =
							"mailto:john.doe@example.com?subject=Hello from AR Card";
					}
				});

				websiteBtn.addEventListener("click", () => {
					console.log("Website button clicked");
					if (confirm("Open website?")) {
						window.open("https://example.com", "_blank");
					}
				});

				console.log("AR Scene loaded successfully!");
			});

			// Error handling
			window.addEventListener("error", (e) => {
				console.error("Error:", e.error);
			});

			// Check if on mobile
			const isMobile =
				/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
					navigator.userAgent
				);
			if (!isMobile) {
				console.warn("This works best on mobile devices with cameras");
			}
		</script>
	</body>
</html>
