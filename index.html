<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>AR Business Card</title>

		<!-- A-Frame & AR.js -->
		<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

		<style>
			body {
				margin: 0;
				overflow: hidden;
				font-family: Arial, sans-serif;
			}
			#info {
				position: fixed;
				top: 10px;
				left: 10px;
				background: rgba(0, 0, 0, 0.8);
				color: white;
				padding: 10px 14px;
				border-radius: 6px;
				z-index: 10;
				font-size: 12px;
			}
		</style>
	</head>

	<body>
		<div id="info">
			<div>ðŸ“· Camera: <span id="cameraStatus">Starting...</span></div>
			<div>ðŸŽ¯ Marker: <span id="detectionStatus">Waiting...</span></div>
			<div>ðŸ“¦ Model: <span id="modelStatus">Loading...</span></div>
		</div>

		<a-scene
			embedded
			arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono; trackingMethod: best;"
			renderer="colorManagement: true; physicallyCorrectLights: true; antialias: true;"
			vr-mode-ui="enabled: false"
			loading-screen="enabled: false"
		>
			<a-assets>
				<a-asset-item
					id="businessModel"
					src="https://abusaeed-shuvo.github.io/arcard/models/business-model.glb"
				></a-asset-item>
			</a-assets>

			<!-- Custom Pattern Marker -->
			<a-marker
				type="pattern"
				url="https://abusaeed-shuvo.github.io/arcard/markers/pattern-logo.patt"
				id="marker"
			>
				<!-- Base Card -->
				<a-box
					position="0 0 0"
					width="2.2"
					height="0.06"
					depth="1.4"
					color="#fff"
				></a-box>

				<!-- Blue Accent -->
				<a-box
					position="0 0.065 -0.65"
					width="2.2"
					height="0.015"
					depth="0.1"
					color="#2196F3"
				></a-box>

				<!-- 3D Model -->
				<a-entity
					id="model3d"
					gltf-model="#businessModel"
					position="0 0.35 0"
					scale="0.4 0.4 0.4"
					animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"
				></a-entity>

				<!-- Fallback Cube -->
				<a-box
					id="fallbackCube"
					position="0 0.35 0"
					rotation="0 45 0"
					scale="0.25 0.25 0.25"
					color="#2196F3"
					visible="false"
					animation="property: rotation; to: 0 405 0; loop: true; dur: 4000"
				></a-box>

				<!-- Text -->
				<a-text
					value="John Doe"
					align="center"
					color="#000"
					width="3"
					position="0 0.07 0.62"
				></a-text>
				<a-text
					value="Creative Developer"
					align="center"
					color="#444"
					width="2.5"
					position="0 0.07 0.47"
				></a-text>

				<!-- Lighting -->
				<a-light type="ambient" intensity="0.6"></a-light>
				<a-light type="directional" position="2 3 1" intensity="0.7"></a-light>
			</a-marker>

			<a-entity camera></a-entity>
		</a-scene>

		<script>
			const cameraStatus = document.getElementById("cameraStatus");
			const detectionStatus = document.getElementById("detectionStatus");
			const modelStatus = document.getElementById("modelStatus");

			window.addEventListener("load", () => {
				const marker = document.querySelector("#marker");
				const model = document.querySelector("#model3d");
				const fallback = document.querySelector("#fallbackCube");

				// Camera status
				navigator.mediaDevices
					.getUserMedia({ video: { facingMode: "environment" } })
					.then((stream) => {
						cameraStatus.textContent = "Active âœ“";
						stream.getTracks().forEach((t) => t.stop());
					})
					.catch(() => (cameraStatus.textContent = "Failed âœ—"));

				// Model load handling
				model.addEventListener("model-loaded", () => {
					modelStatus.textContent = "Loaded âœ“";
					fallback.setAttribute("visible", "false");
				});
				model.addEventListener("model-error", () => {
					modelStatus.textContent = "Error âœ—";
					fallback.setAttribute("visible", "true");
				});

				// Marker detection
				marker.addEventListener("markerFound", () => {
					detectionStatus.textContent = "Detected ðŸŽ¯";
				});
				marker.addEventListener("markerLost", () => {
					detectionStatus.textContent = "Searching...";
				});
			});
		</script>
	</body>
</html>
